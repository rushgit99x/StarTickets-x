@model StarTickets.Models.EventCategory
@{
    ViewData["Title"] = "Delete Category";
    Layout = "~/Views/Shared/CustomLayouts/_CategoryManagement.cshtml";
}

<div class="delete-category-container">
    <h2 class="text-danger">
        <i class="fas fa-tags"></i> Delete Category
    </h2>
    <div class="alert alert-warning">
        <i class="fas fa-exclamation-triangle"></i>
        Are you sure you want to delete the category <strong>@Model.CategoryName</strong>?
        <br><small class="text-muted">This action cannot be undone.</small>
    </div>

    <div class="card mb-4">
        <div class="card-body">
            <dl class="row">
                <dt class="col-sm-3">Category Name</dt>
                <dd class="col-sm-9">@Model.CategoryName</dd>

                <dt class="col-sm-3">Description</dt>
                <dd class="col-sm-9">@(Model.Description ?? "No description provided")</dd>

                <dt class="col-sm-3">Created Date</dt>
                <dd class="col-sm-9">@Model.CreatedAt.ToString("dddd, MMMM dd, yyyy 'at' hh:mm tt")</dd>

                @if (Model.Events?.Any() == true)
                {
                    <dt class="col-sm-3">Associated Events</dt>
                    <dd class="col-sm-9">
                        <div class="category-events">
                            @foreach (var eventItem in Model.Events.Take(5))
                            {
                                <div class="mb-2">
                                    <strong>@eventItem.EventName</strong>
                                    <small class="text-muted">- @eventItem.EventDate.ToString("MMM dd, yyyy")</small>
                                    <span class="badge badge-@(eventItem.Status == StarTickets.Models.EventStatus.Published ? "success" :
                                                                                                                       eventItem.Status == StarTickets.Models.EventStatus.Draft ? "secondary" :
                                                                                                                       eventItem.Status == StarTickets.Models.EventStatus.Cancelled ? "danger" : "warning")">
                                @eventItem.Status
                            </span>
                        </div>
                                                }
                            @if (Model.Events.Count() > 5)
                            {
                                <div class="text-muted">
                                    <small>... and @(Model.Events.Count() - 5) more events</small>
                                </div>
                            }
                        </div>
                    </dd>
                }

                <dt class="col-sm-3">Total Events</dt>
                <dd class="col-sm-9">
                    <span class="badge badge-info">
                        @(Model.Events?.Count ?? 0) events
                    </span>
                </dd>

                <dt class="col-sm-3">Active Events</dt>
                <dd class="col-sm-9">
                    <span class="badge badge-success">
                        @(Model.Events?.Count(e => e.Status == StarTickets.Models.EventStatus.Published) ?? 0) active
                    </span>
                </dd>

                <dt class="col-sm-3">Upcoming Events</dt>
                <dd class="col-sm-9">
                    <span class="badge badge-primary">
                        @(Model.Events?.Count(e => e.EventDate > DateTime.UtcNow) ?? 0) upcoming
                    </span>
                </dd>
            </dl>
        </div>
    </div>

    @if (Model.Events?.Any() == true)
    {
        <div class="alert alert-danger">
            <i class="fas fa-ban"></i>
            <strong>Cannot delete this category!</strong> This category has existing events and cannot be deleted.
            <br><small>Please move or delete the associated events first, or consider creating a new category for future events.</small>
        </div>
        <div class="mt-3">
            <a asp-action="Index" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Back to Categories
            </a>
            <a asp-action="Details" asp-route-id="@Model.CategoryId" class="btn btn-info ml-2">
                <i class="fas fa-info-circle"></i> View Details
            </a>
        </div>
    }
    else
    {
        <form asp-action="DeleteConfirmed" asp-route-id="@Model.CategoryId" method="post" onsubmit="return confirm('Are you absolutely sure you want to delete this category? This action cannot be undone.');">
            @Html.AntiForgeryToken()
            <div class="mt-3">
                <button type="submit" class="btn btn-danger">
                    <i class="fas fa-trash"></i> Delete Category
                </button>
                <a asp-action="Index" class="btn btn-secondary ml-2">
                    <i class="fas fa-times"></i> Cancel
                </a>
                <a asp-action="Details" asp-route-id="@Model.CategoryId" class="btn btn-info ml-2">
                    <i class="fas fa-info-circle"></i> View Details
                </a>
            </div>
        </form>
    }
</div>

<style>
    .delete-category-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
    }

    .category-events .mb-2 {
        padding: 8px 12px;
        background-color: #f8f9fa;
        border-left: 3px solid #007bff;
        border-radius: 4px;
    }

    .alert-warning {
        border: 1px solid #ffeaa7;
        background-color: #fef5e7;
    }

    .alert-danger {
        border: 1px solid #ff7675;
        background-color: #ffeae9;
    }

    .card {
        border: 1px solid #dee2e6;
        border-radius: 8px;
    }

    .badge {
        font-size: 0.875em;
        padding: 0.375em 0.75em;
    }

    .badge-success {
        background-color: #28a745;
    }

    .badge-secondary {
        background-color: #6c757d;
    }

    .badge-danger {
        background-color: #dc3545;
    }

    .badge-warning {
        background-color: #ffc107;
        color: #212529;
    }

    .badge-info {
        background-color: #17a2b8;
    }

    .badge-primary {
        background-color: #007bff;
    }

    .btn-info {
        background-color: #17a2b8;
        border-color: #17a2b8;
    }

        .btn-info:hover {
            background-color: #138496;
            border-color: #117a8b;
        }
</style>